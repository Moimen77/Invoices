<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø±Ù‚ÙŠØ¨</title>
    <style>
        body {
            margin: 0;
            font-family: "Cairo", sans-serif;
            display: flex;
            height: 100vh;
            background-color: #f6f8fa;
            color: #333;
        }

        /* === Sidebar === */
        .sidebar {
            width: 250px;
            background-color: #1e293b;
            color: #fff;
            display: flex;
            flex-direction: column;
            padding-top: 20px;
            transition: 0.3s;
        }

        .sidebar h2 {
            text-align: center;
            font-size: 22px;
            margin-bottom: 30px;
        }

        .sidebar a {
            padding: 15px 25px;
            color: #cbd5e1;
            text-decoration: none;
            display: block;
            transition: 0.2s;
        }

        .sidebar a:hover,
        .sidebar a.active {
            background-color: #334155;
            color: #fff;
        }

        /* === Main Content === */
        .main {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        .header {
            background-color: #fff;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content {
            background-color: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            min-height: 70vh;
        }

        /* Loading text */
        .loading {
            color: #555;
            text-align: center;
        }

        /* Card design for invoices */
        .card {
            background-color: #f9fafb;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
        }

        .status-success {
            color: green;
            font-weight: bold;
        }

        .status-error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <!-- ğŸ§­ Sidebar -->
    <div class="sidebar">
        <h2>ğŸ“Š Ø±Ù‚ÙŠØ¨ Ø£Ø¯Ø®Ø§Ù„Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø£ØµØ·Ù†Ø§Ø¹ÙŠ</h2>
        <a href="#" class="active" onclick="showSection('invoices')">ğŸ“„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</a>
        <a href="#" onclick="showSection('clients')">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
        <a href="#" onclick="showSection('stock')">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a>
    </div>

    <!-- ğŸ§© Main Content -->
    <div class="main">
        <div class="header">
            <h3 id="section-title">ğŸ“„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
            <button
                style="padding:8px 16px;border:none;border-radius:8px;background-color:#1d4ed8;color:#fff;cursor:pointer;">
                ØªØ­Ø¯ÙŠØ« ğŸ”„
            </button>
        </div>

        <div class="content" id="content-area">
            <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ -->
            <p>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¯Ø§Ø¹Ù… â€” Ø§Ø®ØªØ± Ù‚Ø³Ù…Ù‹Ø§ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„.</p>
        </div>
    </div>

    <script>
        // ğŸ§­ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª
        function showSection(section) {
            document.querySelectorAll(".sidebar a").forEach(a => a.classList.remove("active"));
            event.target.classList.add("active");

            const content = document.getElementById("content-area");
            const title = document.getElementById("section-title");

            if (section === "invoices") {
                title.innerText = "ğŸ“„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±";
                content.innerHTML = `
          <h4>ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h4>
          <label>Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„:</label>
          <select id="clientSelect"></select>
          <br><br>
          <input type="file" id="invoice_files" multiple />
          <br><br>
          <button id="upload_btn" type="button" onclick="uploadInvoices()">Ø±ÙØ¹ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>
          <div id="results"></div>
        `;
                loadClients();
            }

            if (section === "clients") {
                title.innerText = "ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡";
                content.innerHTML = `<p>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§...</p>`;
            }

            if (section === "stock") {
                title.innerText = "ğŸ“¦ Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†";
                content.innerHTML = `<p>ğŸ§± Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù‚Ø±ÙŠØ¨Ù‹Ø§.</p>`;
            }
        }

        // ğŸ§¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        // ğŸ§¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        async function loadClients() {
            const select = document.getElementById("clientSelect");
            select.innerHTML = "<option>â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„...</option>";

            try {
                const res = await fetch("http://localhost:8000/clients/get_clients");
                const result = await res.json();

                // ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©
                if (!result.data || !Array.isArray(result.data)) {
                    throw new Error("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©");
                }

                select.innerHTML = "<option value='' disabled selected>Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§</option>";

                result.data.forEach(client => {
                    const opt = document.createElement("option");
                    opt.value = client.client_id;
                    opt.textContent = client.client_name;
                    select.appendChild(opt);
                });
            } catch (e) {
                console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©:", e);
                select.innerHTML = "<option>âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>";
            }
        }


        // ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        async function uploadInvoices() {
            const clientId = document.getElementById("clientSelect").value;
            const files = document.getElementById("invoice_files").files;
            const results = document.getElementById("results");

            if (!clientId || files.length === 0) {
                alert("âš ï¸ Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§ ÙˆÙ…Ù„ÙØ§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹.");
                return;
            }

            const formData = new FormData();
            formData.append("client_id", clientId);
            for (let f of files) formData.append("files", f);

            results.innerHTML = '<p class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª...</p>';

            try {
                const res = await fetch("http://localhost:8000/upload/invoices/", {
                    method: "POST",
                    body: formData,
                });
                const data = await res.json();
                results.innerHTML = "";

                data.processed.forEach(item => {
                    const div = document.createElement("div");
                    div.className = "card";
                    div.innerHTML = `
            <h4>${item.file}</h4>
            <p class="${item.status.includes('âœ…') ? 'status-success' : 'status-error'}">${item.status}</p>
            ${item.error ? `<p>âŒ ${item.error}</p>` : ""}
          `;
                    results.appendChild(div);
                });
            } catch (err) {
                results.innerHTML = `<p class="status-error">âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±</p>`;
            }
        }

        // âœ… Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ Ù†Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        showSection('invoices');
    </script>
</body>

</html>